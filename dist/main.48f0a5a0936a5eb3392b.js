(()=>{"use strict";function t(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class e{constructor(e,i){t(this,"_x",void 0),t(this,"_y",void 0),this._x=e,this._y=i}getLength(){return Math.sqrt(this._x*this._x+this._y*this._y)}isNormal(){return 1===this.getLength()}getNormalized(){const t=this.getLength();if(!t)return new e(0,0);const i=this._x/t,s=this._y/t;return new e(i,s)}add(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new e(this._x+t.x*i,this._y+t.y*i)}substract(t){return new e(this._x-t.x,this._y-t.y)}scale(t){return new e(this._x*t,this._y*t)}dot(t){return this._x*t.x+this._y*t.y}getVectorInRotatedBasis(t){return new e(this._x*Math.cos(t)+this._y*Math.sin(t),this._x*-Math.sin(t)+this._y*Math.cos(t))}isZero(){return 0===this._x&&0===this._y}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}}function i(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class s{constructor(t,e,s){i(this,"_sprites",{cue:void 0,ball:void 0,shadow:void 0}),i(this,"_ctxCue",void 0),i(this,"_ctxBalls",void 0),i(this,"_cueWidth",void 0),i(this,"_maxSpace",void 0),i(this,"_ctxTable",void 0),i(this,"_fadeStop",void 0),i(this,"_tablePos",void 0),i(this,"_cueLength",void 0),i(this,"_tableWidth",void 0),i(this,"_tableHeight",void 0),i(this,"_initialSpace",void 0),i(this,"_fadeGenerator",void 0),i(this,"_cueSpaceWidth",void 0),i(this,"_cueSpaceHeight",void 0),i(this,"_animatePocketHitStop",void 0),i(this,"_viewToModelProportion",void 0),i(this,"_animatePocketHitGenerator",void 0),this._ctxTable=t.getContext("2d"),this._ctxCue=s.getContext("2d"),this._ctxBalls=e.getContext("2d"),this._fadeGenerator=this.fadeOutCue(),this._animatePocketHitGenerator=this.animatePocketHit()}async init(t,i,s){const o=t.getBoundingClientRect();this._cueSpaceWidth=i.width,this._cueSpaceHeight=i.height,this._tableWidth=t.width,this._tableHeight=t.height,this._viewToModelProportion=this._tableWidth/s,this._tablePos=new e(o.left,o.top),this._cueLength=this._tableHeight,this._cueWidth=this._cueLength/32,this._initialSpace=this._cueWidth,this._maxSpace=20*this._initialSpace,this._animatePocketHitStop=!0,this.__fadeStop=!0,await this.loadSprites()}loadSprites(){return new Promise((t=>{const e=Object.keys(this._sprites);let i=0;const s=o=>{this._sprites[o]=new Image,this._sprites[o].onload=()=>{i==e.length-1?t():s(e[++i])},this._sprites[o].src="./img/".concat(o,".png")};s(e[i])}))}renderTable(t){this._ctxTable.clearRect(0,0,this._tableWidth,this._tableHeight),this._ctxTable.fillStyle=s.TABLE_COLOR,this._ctxTable.roundRect(0,0,this._tableWidth,this._tableHeight,t),this._ctxTable.fill()}renderPockets(t,e,i){const o=e*this._viewToModelProportion,r=i*this._viewToModelProportion,h=.3*o;this._ctxTable.lineWidth=h;const a=(t,e,i)=>{const h=-Math.PI*(i/2-1/4);this._ctxTable.fillStyle=s.TABLE_COLOR,this._ctxTable.translate(t,e),this._ctxTable.rotate(-h),this._ctxTable.translate(-t,-e),this._ctxTable.fillRect(t,e-o,2*r,2*o),this._ctxTable.setTransform(1,0,0,1,0,0),this._ctxTable.fillStyle=s.POCKET_COLORS[0],this._ctxTable.beginPath(),this._ctxTable.arc(t,e,o,0,2*Math.PI,!1),this._ctxTable.fill(),this._ctxTable.beginPath(),this._ctxTable.strokeStyle=s.POCKET_COLORS[2],this._ctxTable.lineCap="round";const a=i%1==0?.3:.5;this._ctxTable.arc(t,e,o,(i+a)*Math.PI/2,Math.PI*(i-a+3)/2,!1),this._ctxTable.stroke()};for(let e=0;e<t.length;e++){let i=e>3?2*e+1.5:e+1;a(t[e].x*this._viewToModelProportion,t[e].y*this._viewToModelProportion,i)}}renderWalls(t,e,i){const o=i*this._viewToModelProportion/s.WALL_COLORS.length;let r=o/2;this._ctxTable.lineWidth=o+1;for(let t=0;t<s.WALL_COLORS.length;t++,r+=o){this._ctxTable.strokeStyle=s.WALL_COLORS[t],this._ctxTable.beginPath();let i=.5*(e-r);i=i>0?i:0,this._ctxTable.roundRect(r,r,this._tableWidth-2*r,this._tableHeight-2*r,i),this._ctxTable.stroke()}const h=i*this._viewToModelProportion/15;for(let e of t){if(e.rotate)continue;const t=e.x*this._viewToModelProportion,i=e.y*this._viewToModelProportion,o=e.width*this._viewToModelProportion/4,r=e.height*this._viewToModelProportion/2;this._ctxTable.fillStyle=s.DECOR_COLOR;for(let s=1;s<=3;s++){let a=t+o*s,l=i+r;e.width<e.height&&(a=t+e.width*this._viewToModelProportion/2,l=i+e.height*this._viewToModelProportion/4*s),this._ctxTable.beginPath(),this._ctxTable.arc(a,l,h,0,2*Math.PI),this._ctxTable.fill()}}}renderBalls(t,e){this._ctxBalls.clearRect(0,0,this._tableWidth,this._tableHeight);let i=[];const o=2*(e*=this._viewToModelProportion),r=e*s.SHADOW_SHIFT;this._ctxBalls.globalCompositeOperation="source-over";for(let s=0;s<t.length;s++){const{x:h,y:a}=t[s].pos.scale(this._viewToModelProportion);i.push({x:h,y:a}),this._ctxBalls.drawImage(this._sprites.shadow,h-e,a-o+r,o,o)}for(let i=0;i<t.length;i++){const{x:r,y:h}=t[i].pos.scale(this._viewToModelProportion);this._ctxBalls.fillStyle=s.BALLS_COLORS[t[i].type],this._ctxBalls.beginPath(),this._ctxBalls.arc(r,h,e,0,2*Math.PI,!1),this._ctxBalls.fill(),this._ctxBalls.drawImage(this._sprites.ball,r-e,h-e,o,o)}}renderCue(t,i,s){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t=t.scale(this._viewToModelProportion),i=i.scale(this._viewToModelProportion),s*=this._viewToModelProportion,o*=this._viewToModelProportion;const r=t.substract(i).getNormalized(),h=new e(-r.y,r.x),a=t.add(this._tablePos).add(r,s+this._initialSpace+o*this._maxSpace+this._cueLength).add(h,this._cueWidth/2);let l=Math.acos(-r.x);r.y>0&&(l*=-1),this._ctxCue.clearRect(0,0,this._cueSpaceWidth,this._cueSpaceHeight),this._ctxCue.globalCompositeOperation="source-over",this._ctxCue.translate(a.x,a.y),this._ctxCue.rotate(l),this._ctxCue.translate(-a.x,-a.y),this._ctxCue.drawImage(this._sprites.cue,a.x,a.y,this._cueLength,this._cueWidth),this._ctxCue.setTransform(1,0,0,1,0,0)}fadeOutStart(){this._fadeStop=!1}fadeOutStop(){this._fadeStop=!0,this._fadeGenerator=this.fadeOutCue()}*fadeOutCue(){let t=1;for(;;){if(t-=.01,this._ctxCue.globalCompositeOperation="destination-in",this._ctxCue.fillStyle="rgba(255, 255, 255, ".concat(t,")"),this._ctxCue.fillRect(0,0,this._cueSpaceWidth,this._cueSpaceHeight),!(t>0)||this._fadeStop)return void this._ctxCue.clearRect(0,0,this._cueSpaceWidth,this._cueSpaceHeight);yield}}animatePocketHitStart(t,e,i){this._animatePocketHitStop=!1,this._animatePocketHitGenerator=this.animatePocketHit(t,e,i)}animatePocketHitStop(){this._animatePocketHitStop=!0}*animatePocketHit(t,e,i){i*=this._viewToModelProportion,t=t.scale(this._viewToModelProportion);let o=e.pos.scale(this._viewToModelProportion);const r=t.substract(o).getNormalized(),h=2*i;let a=0,l=.5*e.vel;l>20&&(l=20),l<.5&&(l=.5);const n=i*s.SHADOW_SHIFT;for(;;){if(o===t)a+=.05,this._ctxBalls.globalCompositeOperation="destination-out",this._ctxBalls.fillStyle="rgba(255, 255, 255, ".concat(a,")"),this._ctxBalls.fillRect(o.x-i,o.y-i,h,h+n);else{this._ctxBalls.clearRect(o.x-i-1,o.y-i-1,h+2,h+n+2);const a=t.substract(o).getNormalized();o=o.add(r,l),(Math.abs(a.x-r.x)>1||Math.abs(a.y-r.y)>1)&&(o=t),this._ctxBalls.globalCompositeOperation="source-over",this._ctxBalls.drawImage(this._sprites.shadow,o.x-i,o.y-h+n,h,h),this._ctxBalls.fillStyle=s.BALLS_COLORS[e.type],this._ctxBalls.beginPath(),this._ctxBalls.arc(o.x,o.y,i,0,2*Math.PI,!1),this._ctxBalls.fill(),this._ctxBalls.drawImage(this._sprites.ball,o.x-i,o.y-i,h,h)}if(!(a<1))return void this._ctxBalls.clearRect(o.x-i-1,o.y-i-1,h+2,h+n+2);yield}}animate(){this._fadeStop||this._fadeGenerator.next().done&&this.fadeOutStop(),this._animatePocketHitStop||this._animatePocketHitGenerator.next().done&&this.animatePocketHitStop()}get viewToModelProportion(){return this._viewToModelProportion}}function o(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}i(s,"CUE_COLOR","#2f1212"),i(s,"DECOR_COLOR","#CFB725"),i(s,"TABLE_COLOR","#145127"),i(s,"BALLS_COLORS",{main:"#670730",ordinary:"#D9D9C3"}),i(s,"POCKET_COLORS",["#181111","#222222","#CFB725"]),i(s,"WALL_COLORS",["#A47461","#C48B68","#733D29","#5E2D19","#60311D","#60311D","#60311D","#60311D","#5E2D1B","#411B10","#238E3B","#1D8C39","#238E3B","#177834"]),i(s,"SHADOW_SHIFT",1.3);class r{constructor(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ordinary";o(this,"_pos",void 0),o(this,"_dir",void 0),o(this,"_vel",void 0),o(this,"_type",void 0),this._pos=t,this._dir=new e(0,0),this._vel=0,this._removed=!1,this._type=i}simulate(){this.move(),this.slowDown()}slowDown(){this._vel-=r.FRICTION_KOEF,this._vel<0&&(this._vel=0)}move(){this._pos=this._pos.add(this._dir,this._vel)}collide(t){let e=this.pos.substract(t.pos);const i=e.getLength();if(0===i||i>=2*r.radius)return;e=e.getNormalized();const s=(2*r.radius-i)/2;this.pos=this.pos.add(e,s),t.pos=t.pos.add(e,-s);const o=this.dir.scale(this.vel),h=t.dir.scale(t.vel),a=o.dot(e),l=h.dot(e),n=(a+l-(a-l)*r.RESTITUTION)/2,_=(a+l-(l-a)*r.RESTITUTION)/2,c=o.add(e,n-a),d=h.add(e,_-l);this.dir=c.getNormalized(),t.dir=d.getNormalized(),this.vel=c.getLength(),t.vel=d.getLength()}isInPocket(t,e){return this._pos.substract(t).getLength()<=e}get pos(){return this._pos}set pos(t){this._pos=t}get dir(){return this._dir}set dir(t){t.isNormal()?this._dir=t:this._dir=t.getNormalized()}get vel(){return this._vel}set vel(t){t<0&&(t*=-1,this.dir=this.dir.scale(-1)),this._vel=t}get type(){return this._type}set type(t){this._type=t}}function h(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}o(r,"RESTITUTION",.8),o(r,"FRICTION_KOEF",.03),o(r,"radius",void 0),o(r,"adjusted_friction_koef",void 0);class a{constructor(t,e,i,s){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;h(this,"_x",void 0),h(this,"_y",void 0),h(this,"_width",void 0),h(this,"_height",void 0),h(this,"_rotate",void 0),this._x=t,this._y=e,this._width=i,this._height=s,this._rotate=o}findNearestVertexPos(t,i){const s=new e(i.x,i.y),o=new e(i.x+this._width,this.y+this._height);return Math.abs(s.x-t.x)<Math.abs(o.x-t.x)?Math.abs(s.y-t.y)<Math.abs(o.y-t.y)?{pos:s,horVector:new e(-1,0),vertVector:new e(0,-1)}:{pos:new e(i.x,i.y+this._height),horVector:new e(-1,0),vertVector:new e(0,1)}:Math.abs(s.y-t.y)<Math.abs(o.y-t.y)?{pos:new e(i.x+this._width,i.y),horVector:new e(1,0),vertVector:new e(0,-1)}:{pos:o,horVector:new e(1,0),vertVector:new e(0,1)}}collide(t,i){let s,o,r,h=!1;this._rotate?(h=!0,s=t.pos.getVectorInRotatedBasis(this._rotate),o=t.dir.getVectorInRotatedBasis(this._rotate),r=new e(this._x,this._y).getVectorInRotatedBasis(this._rotate)):(s=t.pos,o=t.dir,r=new e(this._x,this._y));const l=s.add(o,t.vel);if(this.isNextPosInBox(i,l,r)){if(l.y>r.y&&l.y<r.y+this._height)o.x*=-1,t.vel*=a.RESTITUTION,this.checkTrappedBall(s,o,t.vel,i,r);else if(l.x>r.x&&l.x<r.x+this._width)o.y*=-1,t.vel*=a.RESTITUTION,this.checkTrappedBall(s,o,t.vel,i,r);else{const e=this.findNearestVertexPos(l,r),h=l.substract(e.pos),n=h.getLength();if(n>i)return;let _=h.getNormalized();Math.abs(e.horVector.x-_.x)>1?_=e.vertVector:Math.abs(e.vertVector.y-_.y)>1&&(_=e.horVector);const c=2*o.dot(_);o=o.substract(_.scale(c)),s=s.add(_,i-n),t.vel*=a.RESTITUTION}this._rotate?(t.pos=s.getVectorInRotatedBasis(-this._rotate),t.dir=o.getVectorInRotatedBasis(-this._rotate)):(t.pos=s,t.dir=o)}}checkTrappedBall(t,e,i,s,o){const r=t.add(e,i);this.isNextPosInBox(s,r,o)&&(e.x*=-1,e.y*=-1)}isNextPosInBox(t,e,i){return e.x+t>i.x&&e.x-t<i.x+this._width&&e.y+t>i.y&&e.y-t<i.y+this._height}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}get rotate(){return this._rotate}set rotate(t){this._rotate=t}}function l(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}h(a,"RESTITUTION",.7);class n{constructor(t){l(this,"_view",void 0),l(this,"_balls",void 0),l(this,"_walls",void 0),l(this,"_pockets",void 0),l(this,"_hitPower",void 0),l(this,"_targetPos",void 0),l(this,"_chosenBall",void 0),l(this,"_isFirstHit",void 0),l(this,"_isWaitingForHit",void 0),this._view=t,r.radius=n.BALL_RADIUS,this._oldTime=0,this._fpsAdhustKoef=1,this._isWaitingForHit=!0,this._isFirstHit=!0,this._hitPower=0,this._targetPos=new e(0,0),this.initPockets(),this.initWalls(),this.initBalls(),this.renderGame()}renderGame(){this._view.renderTable(n.POCKET_RADIUS),this._view.renderWalls(this._walls,n.POCKET_RADIUS,n.WALL_WIDTH),this._view.renderPockets(this._pockets,n.POCKET_RADIUS,n.WALL_WIDTH,n.POCKET_SHIFT_KOEF),this._view.renderBalls(this._balls,r.radius)}testingStart(){this._isWaitingForHit=!1,this._chosenBall.dir=new e(-.6865867239941715,.6370479148137013),this._chosenBall.vel=10}initBalls(){this._balls=new Array(16);let t=2*r.radius,i=Math.sqrt(3*r.radius*r.radius),s=n.TABLE_WIDTH/3*2,o=n.TABLE_HEIGHT/2,h=0,a=0,l=0,_=1,c=2;this._balls[0]=new r(new e(n.TABLE_WIDTH/4,o),"main"),this.chosenBall=this._balls[0];for(let n=1;n<16;n++)this._balls[n]=new r(new e(s+h,o+a+l)),l+=t+1,n%_==0&&(_+=c,h+=i+1,a-=r.radius,l=0,c++)}initWalls(){const t=2*n.POCKET_RADIUS,e=n.TABLE_WIDTH,i=n.TABLE_HEIGHT,s=n.WALL_WIDTH,o=2*s,r=Math.sqrt(t*t/2)+s,h=(e-t-2*r)/2,l=i-2*r,_=r+h+t;this._walls=[],this._walls[0]=new a(r,0,h,s),this._walls[1]=new a(_,0,h,s),this._walls[2]=new a(r,i-s,h,s),this._walls[3]=new a(_,i-s,h,s),this._walls[4]=new a(0,r,s,l),this._walls[5]=new a(e-s,r,s,l),this._walls[6]=new a(s,r,o,o,3*Math.PI/4),this._walls[7]=new a(r,s,o,o,3*-Math.PI/4),this._walls[8]=new a(e-s,r,o,o,-Math.PI/4),this._walls[9]=new a(e-r,s,o,o,3*-Math.PI/4),this._walls[10]=new a(e-s,i-r,o,o,-Math.PI/4),this._walls[11]=new a(e-r,i-s,o,o,Math.PI/4),this._walls[12]=new a(s,i-r,o,o,3*Math.PI/4),this._walls[13]=new a(r,i-s,o,o,Math.PI/4)}initPockets(){const t=n.POCKET_RADIUS*(1+n.POCKET_SHIFT_KOEF),i=n.TABLE_WIDTH,s=n.TABLE_HEIGHT;this._pockets=[],this._pockets[0]=new e(t,t),this._pockets[1]=new e(i-t,t),this._pockets[2]=new e(i-t,s-t),this._pockets[3]=new e(t,s-t),this._pockets[4]=new e(i/2,t),this._pockets[5]=new e(i/2,s-t)}async start(){let t=performance.now();const e=1e3/n.INTENDED_FPS;let i=0;for(;;){let s=await new Promise(requestAnimationFrame);s-t<e-i||(i=Math.min(e,i+s-t-e),t=s,this.run())}}run(){this._isWaitingForHit?(this._view.fadeOutStop(),this._view.renderCue(this._chosenBall.pos,this._targetPos,r.radius,this._hitPower)):(this.update(),this._view.renderBalls(this._balls,r.radius)),this._view.animate()}update(){let t,e=!0;t:for(let i=0;i<this._balls.length;i++){t=this._balls[i];for(let e=i+1;e<this._balls.length;e++)t.collide(this._balls[e]);for(let e of this._walls)e.collide(t,r.radius);t.simulate();for(let e of this._pockets)if(this.checkPocket(e,t)){if(this._view.animatePocketHitStart(e,t,r.radius),this._balls.splice(i,1),!this._balls)return void this.endGame();this._chosenBall===t&&(this._chosenBall=this._balls[0]),i--;continue t}0!==t.vel&&(e=!1)}e&&(this._isWaitingForHit=!0,this._balls.length<2)&&this.endGame()}chooseBall(t){if(!this._isFirstHit)for(let e=0;e<this._balls.length;e++){if(this._balls[e].pos.substract(t).getLength()<=r.radius)return void(this._chosenBall=this._balls[e])}}hitBall(){!this._balls.includes(this._chosenBall)||this._hitPower<.05||(this._isWaitingForHit=!1,this._isFirstHit=!1,this._chosenBall.dir=this._targetPos.substract(this._chosenBall.pos),this._chosenBall.vel=this._hitPower*n.MAX_HIT_POWER,this._view.renderCue(this.chosenBall.pos,this.targetPos,r.radius),this._view.fadeOutStart())}checkPocket(t,e){return e.pos.substract(t).getLength()<n.POCKET_RADIUS}endGame(){this.restart()}restart(){this.initBalls(),this._isWaitingForHit=!0,this._isFirstHit=!0,this._hitPower=0,this._view.renderBalls(this._balls,r.radius)}set targetPos(t){this._targetPos=t}get targetPos(){return this._targetPos}set chosenBall(t){this._chosenBall=t}get chosenBall(){return this._chosenBall}set hitPower(t){t<0?t=0:t>1&&(t=1),this._hitPower=t}get hitPower(){return this._hitPower}set isWaitingForHit(t){this._isWaitingForHit=t}get isWaitingForHit(){return this._isWaitingForHit}get canvasAdjKoef(){return this._canvasAdjKoef}}function _(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}l(n,"WALL_WIDTH",80),l(n,"BALL_RADIUS",20),l(n,"TABLE_WIDTH",2048),l(n,"TABLE_HEIGHT",1024),l(n,"INTENDED_FPS",60),l(n,"MAX_HIT_POWER",30),l(n,"POCKET_RADIUS",35),l(n,"WALL_RESTITUTION",.65),l(n,"POCKET_SHIFT_KOEF",.5);class c{constructor(t,e,i){_(this,"_model",void 0),_(this,"_canvasRect",void 0),_(this,"_mouseMoveFunction",void 0),_(this,"_mouseDownFunction",void 0),_(this,"_modelToControlProportion",void 0),this._model=t,this._canvasRect=e.getBoundingClientRect(),this._modelToControlProportion=1/i,this.initMouseControl()}resizeInit(t,e){this._canvasRect=t.getBoundingClientRect(),this._modelToControlProportion=1/e}initMouseControl(){let t,i=null,s=new e(0,0);window.addEventListener("mousemove",(o=>{const r=new e(o.clientX-this._canvasRect.x,o.clientY-this._canvasRect.y);i?(s=r.substract(i),this._model.hitPower=4*this._modelToControlProportion*t.dot(s)/this._canvasRect.width):(s=new e(0,0),this._model.targetPos=r.scale(this._modelToControlProportion))})),window.addEventListener("mousedown",(s=>{this._model.isWaitingForHit&&(i=new e(s.clientX-this._canvasRect.x,s.clientY-this._canvasRect.y),t=this._model.chosenBall.pos.scale(1/this._modelToControlProportion).substract(i).getNormalized(),window.addEventListener("mouseup",(()=>{this._model.hitPower<c.HIT_POWER_TRASHOLD?this._model.chooseBall(i.scale(this._modelToControlProportion)):this._model.hitBall(),this._model.hitPower=0,i=null}),{once:!0}))})),document.getElementById("restart").addEventListener("click",(()=>{this._model.restart()}))}mouseMoveFunction(){}mouseDownFunction(){}}_(c,"HIT_POWER_TRASHOLD",.05);const d=document.getElementById("canvas-table"),u=document.getElementById("canvas-balls"),v=document.getElementById("canvas-cue");let w,g,p;const b=function(){const t=d.getBoundingClientRect(),e=t.width,i=t.height;d.width=e,d.height=i,u.width=e,u.height=i,v.width=window.innerWidth,v.height=window.innerHeight};!async function(){b(),w=new s(d,u,v),await w.init(d,v,n.TABLE_WIDTH),console.log("2"),g=new n(w),p=new c(g,d,w.viewToModelProportion),g.start(),window.addEventListener("resize",(async()=>{b(),await w.init(d,v,n.TABLE_WIDTH),g.renderGame(),p.resizeInit(d,w.viewToModelProportion)}))}(),console.log("v1")})();